# GX1 v1.1 → Hybrid exit controller ADAPTIVE (system-level router switching) full-year replay
#
# Entry: FARM_V2B mp68_max5_cd0 (long-only)
# Exit: Adaptive router switching between V1 (aggressive) and V2B (conservative) per trade
# Window: Full 2025 (2025-01-02 → 2025-12-31) – supply dates via replay CLI
#
# Adaptive routing logic:
#   if atr_pct >= 65% and spread_pct <= 40%:
#       use HYBRID_ROUTER_V1 (more aggressive in high-volatility markets)
#   else:
#       use HYBRID_ROUTER_V2B (conservative in quieter markets)
#
# Rationale:
#   - High-volatility Q2 → use V1 (more aggressive RULE6A)
#   - Quieter Q3/Q4 → use V2B (conservative, only sweet spots)
#   - News periods → fall back to V2B (safety)
#   - Quiet Asia → V1 can be good (hyperactive RULE6A)

meta:
  router_version: ADAPTIVE
  role: HIGH_VOLUME_MODE
  description: >
    Adaptive router with highest trade count and highest total PnL. Lower EV/trade than V3 but much higher frequency.
    Suitable for high-volume or exploratory modes.

policy_name: GX1_V11_OANDA_DEMO_V9_FARM_V2B_EXIT_HYBRID_FULLYEAR_ADAPTIVE
version: "GX1_V11_OANDA_DEMO_V9_FARM_V2B_EXIT_HYBRID_FULLYEAR_ADAPTIVE"
mode: "REPLAY"
instrument: "XAU_USD"
timeframe: "M5"
warmup_bars: 288

entry_config: gx1/configs/policies/prod_snapshot/2025_FARM_V2B_HYBRID/ENTRY_V9_FARM_V2B_PROD.yaml
exit_config: gx1/configs/exits/FARM_EXIT_V2_RULES_A_mp68_max5_rule5_cd0.yaml

exit_policies:
  rule5: gx1/configs/exits/FARM_EXIT_V2_RULES_A_mp68_max5_rule5_cd0.yaml
  rule6a: gx1/configs/exits/FARM_EXIT_V2_RULES_ADAPTIVE_v1.yaml

exit_hybrid:
  enabled: true
  mode: RULE5_RULE6A_ATR_SPREAD_V1
  atr_low_pct: 0.0
  atr_high_pct: 75.0
  max_spread_pct: 40.0
  allowed_regimes:
    - FARM_ASIA_MEDIUM
  exit_params:
    enable_tp: true
    enable_trailing: true
    enable_be: true

hybrid_exit_router:
  version: HYBRID_ROUTER_ADAPTIVE
  # Adaptive switching thresholds
  high_vol_atr_threshold: 65.0  # Use V1 (aggressive) when atr_pct >= 65%
  low_spread_threshold: 40.0    # Use V1 when spread_pct <= 40%
  documentation: |
    HYBRID_ROUTER_ADAPTIVE provides system-level adaptive routing:
    
    Routing decision per trade:
      if atr_pct >= 65% and spread_pct <= 40%:
          → Use HYBRID_ROUTER_V1 (more aggressive, allows RULE6A in sweet spots)
      else:
          → Use HYBRID_ROUTER_V2B (conservative, only high-confidence RULE6A)
    
    Expected behavior:
      - High-volatility periods (Q2): More V1 usage → higher RULE6A allocation
      - Quieter periods (Q3/Q4): More V2B usage → conservative RULE6A allocation
      - News periods: Falls back to V2B (safety first)
      - Quiet Asia sessions: V1 can be beneficial (hyperactive RULE6A)
    
    This provides system-level adaptivity, not just exit-level adaptivity.

trade_log_csv: gx1/wf_runs/GX1_V11_OANDA_DEMO_V9_FARM_V2B_EXIT_HYBRID_FULLYEAR_ADAPTIVE/trade_log.csv

logging:
  level: INFO
  log_dir: gx1/wf_runs/GX1_V11_OANDA_DEMO_V9_FARM_V2B_EXIT_HYBRID_FULLYEAR_ADAPTIVE/logs

execution:
  max_open_trades: 5

risk:
  min_time_between_trades_sec: 0

