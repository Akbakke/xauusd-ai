# GX1 v1.1 → Hybrid exit controller V2 (RULE5 + RULE6A) full-year replay
#
# Entry: FARM_V2B mp68_max5_cd0 (long-only)
# Exit: RULE5 default + hybrid routing V2 (ML decision tree) per trade
# Window: Full 2025 (2025-01-02 → 2025-12-31) – supply dates via replay CLI

meta:
  router_version: V2
  role: RESEARCH_ONLY
  description: >
    Early ML-based router with ~40% RULE6A share and significantly lower EV/trade (~70 bps) and win rate (~72%).
    Kept only as a reference for what over-aggressive RULE6A usage looks like.

policy_name: GX1_V11_OANDA_DEMO_V9_FARM_V2B_EXIT_HYBRID_FULLYEAR_V2
version: "GX1_V11_OANDA_DEMO_V9_FARM_V2B_EXIT_HYBRID_FULLYEAR_V2"
mode: "REPLAY"
instrument: "XAU_USD"
timeframe: "M5"
warmup_bars: 288

entry_config: gx1/configs/policies/prod_snapshot/2025_FARM_V2B_HYBRID/ENTRY_V9_FARM_V2B_PROD.yaml
exit_config: gx1/configs/exits/FARM_EXIT_V2_RULES_A_mp68_max5_rule5_cd0.yaml

exit_policies:
  rule5: gx1/configs/exits/FARM_EXIT_V2_RULES_A_mp68_max5_rule5_cd0.yaml
  rule6a: gx1/configs/exits/FARM_EXIT_V2_RULES_ADAPTIVE_v1.yaml

exit_hybrid:
  enabled: true
  mode: RULE5_RULE6A_ATR_SPREAD_V1
  atr_low_pct: 0.0
  atr_high_pct: 75.0
  max_spread_pct: 40.0
  allowed_regimes:
    - FARM_ASIA_MEDIUM
  exit_params:
    enable_tp: true
    enable_trailing: true
    enable_be: true

hybrid_exit_router:
  version: HYBRID_ROUTER_V2
  # Thresholds below are for documentation only - actual routing is controlled by ML decision tree
  atr_pct_threshold: 0.75   # keep trades below 75th ATR percentile on RULE6A scalper mode
  spread_pct_threshold: 0.40  # require spread percentile ≤40% for RULE6A selection
  allowed_regimes: ["FARM_ASIA_MEDIUM"]
  documentation: |
    HYBRID_ROUTER_V2 uses ML decision tree from:
      gx1/analysis/exit_router_models/exit_router_decision_tree_rules.txt
    
    Tree was trained on Q2-Q4 2025 data comparing RULE5 vs RULE6A performance.
    Routing decisions are based on standardized atr_pct values.
    
    V1 (rule-based): 88.9% RULE5 / 11.1% RULE6A
    V2 (ML tree): TBD - run Q1-Q4 replays to compare

trade_log_csv: gx1/wf_runs/FARM_V2B_EXIT_HYBRID_2025_V2/trade_log.csv

logging:
  level: INFO
  log_dir: gx1/wf_runs/FARM_V2B_EXIT_HYBRID_2025_V2/logs

execution:
  max_open_trades: 5

risk:
  min_time_between_trades_sec: 0

