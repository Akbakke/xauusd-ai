# GX1 v1.1 → Practice LIVE Force-One-Trade (CANARY only)
#
# Mål: Få minst én trade i OANDA practice LIVE for å bekrefte plumbing:
#   - live candles kommer inn
#   - entry→router→exit prater sammen
#   - trade journal + execution events + reconciliation produseres
#
# VIKTIG: Dette er KUN for plumbing testing. IKKE for PROD_BASELINE.
# meta.role: CANARY (IKKE PROD_BASELINE)
# debug_force: enabled for å garantere minst 1 trade innen 30 minutter
#
# Entry: FARM_V2B mp68_max5_cd0 (long-only)
# Exit: HYBRID_ROUTER_V3_RANGE (samme som prod_snapshot for parity)
# Router: Bruker samme router model path som prod_snapshot

meta:
  router_version: V3_RANGE
  role: CANARY  # IKKE PROD_BASELINE - kun for plumbing testing
  description: >
    Practice LIVE Force-One-Trade mode. Kun for plumbing testing i OANDA practice.
    Garantrerer minst 1 trade innen 30 minutter hvis ingen trades oppstår naturlig.
    IKKE for PROD_BASELINE - skal aldri brukes i produksjon.

policy_name: GX1_V11_OANDA_PRACTICE_LIVE_FORCE_ONE_TRADE
version: "GX1_V11_OANDA_PRACTICE_LIVE_FORCE_ONE_TRADE"
mode: "LIVE"  # LIVE mode for ekte trading (ikke REPLAY)
instrument: "XAU_USD"
timeframe: "M5"
warmup_bars: 288

entry_config: gx1/configs/policies/prod_snapshot/2025_FARM_V2B_HYBRID/ENTRY_V9_FARM_V2B_PROD.yaml
exit_config: gx1/configs/exits/FARM_EXIT_V2_RULES_A_mp68_max5_rule5_cd0.yaml

exit_policies:
  rule5: gx1/configs/exits/FARM_EXIT_V2_RULES_A_mp68_max5_rule5_cd0.yaml
  rule6a: gx1/configs/exits/FARM_EXIT_V2_RULES_ADAPTIVE_v1.yaml

hybrid_exit_router:
  version: HYBRID_ROUTER_V3
  model_path: gx1/configs/policies/prod_snapshot/2025_FARM_V2B_HYBRID_V3_RANGE/exit_router_models_v3/exit_router_v3_tree.pkl
  v3_range_edge_cutoff: 1.0  # Guardrail: RULE6A only when range_edge_dist_atr < 1.0
  documentation: "HYBRID_ROUTER_V3_RANGE (same as prod_snapshot for parity). Uses range features + guardrail."

execution:
  max_open_trades: 1  # Safety limit
  dry_run: false  # REAL ORDERS (practice only)

logging:
  level: INFO  # DEBUG valgfritt via flag

# Backfill configuration (hent historiske candles ved oppstart)
backfill:
  enabled: true  # Enable backfill to get warmup_bars + padding immediately
  overlap_bars: 6  # Overlap for gap detection
  lookback_padding: 100  # Extra bars for feature rehydration
  target_bars_padding: 100  # Padding beyond warmup_bars (target = warmup_bars + padding = 288 + 100 = 388)

# Debug force entry (CANARY only - kun for plumbing testing)
debug_force:
  enabled: true  # Enable force entry after timeout
  max_trades: 1  # Hard cap: max 1 trade total
  allowed_session: null  # null = any session (for plumbing test)
  force_entry_if_no_trade_after_minutes: 30  # Force entry after 30 minutes if no trades
  min_spread_pct: null  # Use existing spread guard, don't bypass
  bypass_trend_vol_unknown: false  # Don't bypass trend/vol checks

